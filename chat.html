<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title> David ä¸ ç¾éš¾å¤§æ¨¡å‹ çš„èŠå¤© </title>

    <!-- for mobile screens -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- stylesheets are conveniently separated into components -->
    <link rel="stylesheet" media="all" href="component/styles/setup.css">
    <link rel="stylesheet" media="all" href="component/styles/says.css">
    <link rel="stylesheet" media="all" href="component/styles/reply.css">
    <link rel="stylesheet" media="all" href="component/styles/typing.css">
    <link rel="stylesheet" media="all" href="component/styles/input.css">
    <style>
        body {
            background: #dcdde0;
        }

        .bubble-container {
            height: 100vh;
        }

        .bubble-container .input-wrap textarea {
            margin: 0;
            width: calc(100% - 30px);
        }

    </style>
</head>

<body>

    <!-- container element for chat window -->
    <div id="chat"></div>

    <!-- import the JavaScript file -->
    <script src="component/Bubbles.js"></script>
    <script>
        // initialize by constructing a named function...
        // ...and add text processing plugin:
        var chatWindow = new Bubbles(document.getElementById("chat"), "chatWindow", {
            // the one that we care about is inputCallbackFn()
            // this function returns an object with some data that we can process from user input
            // and understand the context of it

            // this is an example function that matches the text user typed to one of the answer bubbles
            // this function does no natural language processing
            // this is where you may want to connect this script to NLC backend.
            inputCallbackFn: function (o) {
                // add error conversation block & recall it if no answer matched
                var miss = function () {
                    chatWindow.talk(
                        {
                            "i-dont-get-it": {
                                says: [
                                    "æŠ±æ­‰æ²¡èƒ½ç†è§£æ‚¨çš„æ„æ€, æˆ‘ä»¥å…³é—­éä¸šåŠ¡èŠå¤©èƒ½åŠ›, å¯å°è¯•å¦‚ä¸‹è¾“å…¥"
                                ],
                                // reply: o.convo[o.standingAnswer].reply
                                reply: [
                                    {
                                        question: "æŸ¥çœ‹ç¾éš¾",
                                        answer: "wild-fire"
                                    },
                                    {
                                        question: "æŸ¥çœ‹ä¾›åº”å•†åˆ—è¡¨",
                                        answer: "vendor-list"
                                    },
                                    {
                                        question: "æŸ¥çœ‹ç”Ÿæ•ˆçš„é€šçŸ¥",
                                        answer: "notification-list"
                                    },
                                    {
                                        question: "ä»å¤´å†æ¥",
                                        answer: "ice"
                                    }
                                ]
                            }
                        },
                        "i-dont-get-it"
                    )
                }

                // do this if answer found
                var match = function (key) {

                    setTimeout(function () {
                        chatWindow.talk(convo, key) // restart current convo from point found in the answer
                    }, 300)
                }

                // sanitize text for search function
                var strip = function (text) {
                    return text.toLowerCase().replace(/[\s.,\/#!$%\^&\*;:{}=\-_'"`~()]/g, "")
                }

                // search function
                var found = false
                /*
                for (const dialog of o.convo) {
                    dialog.reply.forEach(function (e, i) {
                        strip(e.question).includes(strip(o.input)) && o.input.length > 0
                            ? (found = e.answer)
                            : found ? null : (found = false)
                    })
                    if (found) { break; }
                }
                found ? match(found) : miss()
                */


                // o.convo.forEach(function (dialog, i) {
                //     dialog.reply.forEach(function (e, i) {
                //         strip(e.question).includes(strip(o.input)) && o.input.length > 0
                //             ? (found = e.answer)
                //             : found ? null : (found = false)
                //     })
                //     if (found) { return; }
                // })


                o.convo[o.standingAnswer].reply.forEach(function (e, i) {
                    strip(e.question).includes(strip(o.input)) && o.input.length > 0
                        ? (found = e.answer)
                        : found ? null : (found = false)
                })
                found ? match(found) : miss()

            }
        }) // done setting up chat-bubble

        // conversation object defined separately, but just the same as in the
        // "Basic chat-bubble Example" (1-basics.html)

        var convo = {
            ice: { // the starting point 
                says: ["æˆ‘æ˜¯ç¾éš¾å¤§æ¨¡å‹", "æ¬¢è¿å›æ¥, David!", "æœ€è¿‘ç¾å›½åŠ å·å‘ç”Ÿäº†é‡ç«, ä½†å…¬å¸æœ€è¿‘æ²¡æœ‰é¡¹ç›®ä½¿ç”¨åŠ å·çš„ä¾›åº”å•†, æ˜¯å¦æŸ¥çœ‹é‡ç«é€ æˆçš„å½±å“?"],
                reply: [
                    {
                        question: "æŸ¥çœ‹é‡ç«",
                        answer: "wild-fire"
                    },
                    {
                        question: "æŸ¥çœ‹ä¾›åº”å•†ä¿¡æ¯",
                        answer: "vendor-list"
                    },
                    {
                        question: "æŸ¥çœ‹ç”Ÿæ•ˆçš„é€šçŸ¥",
                        answer: "notification-list"
                    }
                ]
            },
            "wild-fire": {
                says: [`è¿™åœºé«˜åœ°å¤§ç«çš„è§„æ¨¡ä»å‘¨ä¸€ï¼ˆ30æ—¥ï¼‰æ™šåˆ°å‘¨äºŒï¼ˆ31æ—¥ï¼‰å‡ ä¹æ‰©å¤§äº†ä¸€å€ã€‚
                æˆªè‡³å‘¨äºŒæ™šä¸Šï¼ŒåŠ å·æ£®æ—æ¶ˆé˜²å±€ï¼ˆCal Fireï¼‰å·²æ§åˆ¶çº¦10%çš„ç«åŠ¿ã€‚`],
                reply: [
                    {
                        question: "æ˜¯å¦æœ‰åŸææ–™ä¼šé—´æ¥å—åˆ°å½±å“?",
                        answer: "affected"
                    }, {
                        question: "æ›´æ–°ä¾›åº”å•†ä¿¡æ¯",
                        answer: "vendor-update"
                    }
                ]
            },
            "vendor-list": {
                says: [`å½“å‰æœ‰ 3 ä¸ªé¡¹ç›®, ä¸€å…±æ¶‰åŠ 10 ä¸ªä¾›åº”å•†`, `
                é’¢æä¾›åº”å•†ï¼šArcelorMittalï¼ˆå®‰èµ›ä¹ç±³å¡”å°”ï¼‰ï¼Œå…¨çƒæœ€å¤§çš„é’¢é“ç”Ÿäº§å•†ä¹‹ä¸€ï¼Œæä¾›é«˜è´¨é‡çš„é’¢æäº§å“`, `
é“åˆé‡‘ä¾›åº”å•†ï¼šAlcoaï¼ˆç¾å›½é“ä¸šå…¬å¸ï¼‰ï¼Œå…¨çƒé¢†å…ˆçš„é“ç”Ÿäº§å•†ï¼Œæä¾›å¤šç§ç‰Œå·çš„é“åˆé‡‘ææ–™ã€‚`, `
é•åˆé‡‘ä¾›åº”å•†ï¼šMagna Internationalï¼ˆéº¦æ ¼çº³å›½é™…ï¼‰ï¼Œä¸€å®¶å…¨çƒæ€§çš„æ±½è½¦é›¶éƒ¨ä»¶ä¾›åº”å•†ï¼Œä¹Ÿç”Ÿäº§é•åˆé‡‘å‹é“¸ä»¶ã€‚`, ` 
æ©¡èƒ¶ä¾›åº”å•†ï¼šBridgestoneï¼ˆæ™®åˆ©å¸é€šï¼‰ï¼Œä¸–ç•Œè‘—åçš„è½®èƒå’Œæ©¡èƒ¶åˆ¶å“ç”Ÿäº§å•†ã€‚`, `
åŒ–å­¦å“ä¾›åº”å•†ï¼šDow Chemicalï¼ˆé™¶æ°åŒ–å­¦ï¼‰ï¼Œå…¨çƒæœ€å¤§çš„åŒ–å­¦å“ç”Ÿäº§å•†ä¹‹ä¸€ï¼Œæä¾›å„ç§åŒ–å­¦å“è§£å†³æ–¹æ¡ˆã€‚`, "..."],
                reply: [
                    {
                        question: "æ˜¯å¦æœ‰åŸææ–™ä¼šé—´æ¥å—åˆ°å½±å“?",
                        answer: "affected"
                    }, {
                        question: "æ›´æ–°åŸææ–™ä¿¡æ¯ä¿¡æ¯",
                        answer: "vendor-update"
                    }
                ]
            },
            "notification-list": {
                says: [`æ‚¨æœ‰ 6 ä¸ªå¤„äºå¼€å¯ä¸­çš„é€šçŸ¥. 
                æ ¹æ®æ‚¨é…ç½®çš„èµ„æºåˆ©ç”¨é…ç½®, æ‰€æœ‰äº‹ä»¶å°†ä¼šåœ¨å‘ç”Ÿä¸€å°æ—¶å†…æ”¶åˆ°é€šçŸ¥. 
                é¢„è®¡ç›¸å…³äººå‘˜å¹³å‡æ¯å¤©æ”¶åˆ° 1 æ¡é€šçŸ¥.`, `å¦‚æœéœ€è¦è®¨è®ºåº”å¯¹æªæ–½, å»ºè®® "é‚€è¯·ä¼šè®®" `],
                reply: [
                    {
                        question: "ç®¡ç†é€šçŸ¥",
                        answer: "notification-update"
                    }, {
                        question: "æ£€æŸ¥æ”¶ä¿¡äºº",
                        answer: "notification-receivers"
                    }, {
                        question: "é‚€è¯·ä¼šè®®",
                        answer: "email-invite"
                    }
                ]
            },
            "notification-update": {
                says: [`åŠŸèƒ½ç»´æŠ¤ä¸­`],
                reply: [
                    {
                        question: "æŸ¥çœ‹ä¾›åº”å•†åˆ—è¡¨",
                        answer: "vendor-list"
                    }, {
                        question: "ä»å¤´å†æ¥",
                        answer: "ice"
                    }
                ]
            },
            "affected": {
                says: [`ä»¥ä¸‹æ˜¯ç°åœ¨å¼€å¯çš„é€šçŸ¥. 
                æ ¹æ®æ‚¨é…ç½®çš„èµ„æºåˆ©ç”¨é…ç½®, æ‰€æœ‰äº‹ä»¶å°†ä¼šåœ¨å‘ç”Ÿä¸€å°æ—¶å†…æ”¶åˆ°é€šçŸ¥. 
                é¢„è®¡ç›¸å…³äººå‘˜å¹³å‡æ¯å¤©æ”¶åˆ° 1 æ¡é€šçŸ¥.`],
                reply: [
                    {
                        question: "æ˜¯å¦æœ‰åŸææ–™ä¼šé—´æ¥å—åˆ°å½±å“?",
                        answer: "affected"
                    }, {
                        question: "æ›´æ–°ä¾›åº”å•†ä¿¡æ¯",
                        answer: "vendor-update"
                    }
                ]
            },
            "vendor-update": {
                says: [`å¥½çš„, è¯·ä¸Šä¼ ä¾›åº”å•†åˆ—è¡¨, æˆ–è€…é€æ¡è¾“å…¥æ–°å¢çš„ä¾›åº”å•†ä¿¡æ¯`, `...`, `æ”¶åˆ°æ–‡ä»¶, è§£æä¸­`, `...`, `æ­£åœ¨æ›´æ–°ä¾›åº”å•†åˆ—è¡¨`, `æ–°çš„ä¾›åº”å•†åˆ—è¡¨æ›´æ–°å®Œæˆ`,
                    `æ‚¨æœ‰ 3 ä¸ªåŸææ–™è®¡åˆ’å‘ç”Ÿäº†è°ƒæ•´, åŸæœ¬ä¾›åº”å•†é—´æ¥æ”¶åˆ°æ—§é‡‘å±±é‡ç«çš„å½±å“æ¦‚ç‡åœ¨ 40%, æ–°ä¾›åº”å•†çš„ä»·æ ¼ä¸Šæµ® 1.3%, è¿™æ˜¯ä¼ä¸šé™ä½é£é™©çš„æ˜æ™ºçš„å†³ç­–!`, `æ˜¯å¦é‚€è¯·ç›¸å…³äººå‘˜æ¨è¿›å®¡æ‰¹æ‰§è¡Œ?`],
                reply: [
                    {
                        question: "é‚€è¯·ä¼šè®®",
                        answer: "email-invite"
                    }, {
                        question: "ç›´æ¥æ‰§è¡Œ",
                        answer: "confirm-exe"
                    }
                ]
            },
            "email-invite": {
                says: [`æ­¤é—®é¢˜çš„å†å²ä¹ æƒ¯, æ‚¨éœ€è¦é‚€è¯·`],
                reply: [
                    {
                        question: "ç¡®è®¤é‚€è¯·",
                        answer: "email-confirm"
                    }, {
                        question: "ä¹Ÿå¯è¾“å…¥æ¬²åˆ é™¤çš„ç¼–å·æˆ–æ¬²å¢åŠ çš„äººå‘˜",
                        answer: "manage-receivers"
                    }
                ]
            },
            "confirm-exe": {
                says: [`æ–°çš„åŸææ–™è®¡åˆ’å·²å®‰æ’, è¾›è‹¦äº†! `],
                reply: [
                    {
                        question: "ä¸‹ç­",
                        answer: "ice"
                    }, {
                        question: "æŸ¥çœ‹ä¾›åº”å•†",
                        answer: "vendor-list"
                    }
                ]
            },
            banana: {
                says: ["ğŸŒ"],
                reply: [
                    {
                        question: "Start Over",
                        answer: "ice"
                    }
                ]
            },
            "ice-cream": {
                says: ["ğŸ¦"],
                reply: [
                    {
                        question: "Start Over",
                        answer: "ice"
                    }
                ]
            }
        }

        // pass JSON to your function and you're done!
        chatWindow.talk(convo)
    </script>
</body>
